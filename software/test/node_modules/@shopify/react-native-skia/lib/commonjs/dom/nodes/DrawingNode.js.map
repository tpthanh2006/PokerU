{"version":3,"names":["_Node","require","_PaintNode","_RenderNode","_defineProperty","e","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","JsiDrawingNode","JsiRenderNode","constructor","ctx","type","props","derived","deriveProps","setProps","setProp","name","hasChanged","addChild","child","JsiDeclarationNode","Error","insertChildBefore","before","renderNode","paint","draw","children","map","PaintNode","declCtx","declarationCtx","save","decorate","paints","pop","restore","exports"],"sources":["DrawingNode.ts"],"sourcesContent":["import type {\n  DrawingContext,\n  DrawingNodeProps,\n  Node,\n  NodeType,\n  RenderNode,\n} from \"../types\";\n\nimport type { NodeContext } from \"./Node\";\nimport { JsiDeclarationNode } from \"./Node\";\nimport { PaintNode } from \"./PaintNode\";\nimport { JsiRenderNode } from \"./RenderNode\";\n\nexport abstract class JsiDrawingNode<P extends DrawingNodeProps, C>\n  extends JsiRenderNode<P>\n  implements RenderNode<P>\n{\n  protected derived?: C;\n\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, type, props);\n    this.derived = this.deriveProps();\n  }\n\n  setProps(props: P) {\n    super.setProps(props);\n    this.derived = this.deriveProps();\n  }\n\n  setProp<K extends keyof P>(name: K, value: P[K]) {\n    const hasChanged = super.setProp(name, value);\n    if (hasChanged) {\n      this.derived = this.deriveProps();\n    }\n    return hasChanged;\n  }\n\n  addChild(child: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add ${child.type} to ${this.type}`);\n    }\n    super.addChild(child);\n    this.derived = this.deriveProps();\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add ${child.type} to ${this.type}`);\n    }\n    super.insertChildBefore(child, before);\n    this.derived = this.deriveProps();\n  }\n\n  renderNode(ctx: DrawingContext): void {\n    if (this.props.paint) {\n      this.draw({ ...ctx, paint: this.props.paint });\n    } else {\n      this.draw(ctx);\n    }\n    this.children().map((child) => {\n      if (child instanceof PaintNode) {\n        const declCtx = ctx.declarationCtx;\n        declCtx.save();\n        child.decorate(declCtx);\n        const paint = declCtx.paints.pop()!;\n        declCtx.restore();\n        this.draw({ ...ctx, paint });\n      }\n    });\n  }\n\n  protected abstract draw(ctx: DrawingContext): void;\n  protected abstract deriveProps(): C;\n}\n"],"mappings":"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","ignoreList":[]}